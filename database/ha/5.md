# 配置变更
在Raft里面要想实现配置变更主要有以下三种方式：
1. 关闭集群，更改配置，然后再启动集群
2. 每次都单节点的增删节点
3. 使用Joint Consensus来实现增删多节点

# （增/删）单节点
## 步骤
1. 向Leader提交一个成员变更请求，请求的内容为服务节点的是添加还是移除，以及服务节点的地址信息
2. Leader在收到请求以后，回向日志中追加一条ConfChange的日志，其中包含了Cnew，后续这些日志会随着AppendEntries的RPC同步所有的Follower节点中
3. 当ConfChange的日志被添加到日志中是立即生效（注意：不是等到提交以后才生效）
4. 当ConfChange的日志被复制到Cnew的Majority服务器上时，那么就可以对日志进行提交了

## 证明
下图就是Raft论文中的配图，能够实现单节点配置变更的关键在于：**C<sub>old</sub>的Majority和C<sub>new</sub>的Majority之间一定存在交集**，而两个配置文件存在交集就意味着相交的那个元素要么归属Old配置要么归属New配置（一个节点在一个Term里面只能投一次票），所以集群中只会有一个多数派，也就是说只会有一个Leader，这样就可以保证Raft协议正确执行。

**即使集群中存在两份不同的配置文件，但是仍然能且仅能选举出一个Leader**

![image](https://user-images.githubusercontent.com/56379080/184103573-d5a36e03-55c6-4366-adfa-9032739fda05.png)

### 增加节点情况
下面给出在3节点集群上增加1个节点的情况：
```
Old: S1, S2, S3        Majority Need:2
New: S1, S2, S3, S4    Majority need:3
// 此时在Old中实现Majority可能需要S1，S2；在New中实现Majority可能需要S2，S3，S4，存在交集
// 此时Old配置文件中的Majority与New配置文件中的Majority一定存在交集
```

下面给出在4节点集群上增加1个节点的情况：
```
Old: S1, S2, S3, S4        Majority Need:3
New: S1, S2, S3, S4, S5    Majority need:3
// 此时在Old中实现Majority可能需要S1，S2, S3；在New中实现Majority可能需要S3，S4，S5，存在交集
// 此时Old配置文件中的Majority与New配置文件中的Majority一定存在交集
```

### 删除节点情况
下面给出在4节点集群上删除1个节点的情况：
```
Old: S1, S2, S3, S4    Majority need:3
New: S1, S2, S3        Majority Need:2
// 此时在Old中实现Majority可能需要S2，S3，S4；在New中实现Majority可能需要S1，S2，存在交集
// 此时Old配置文件中的Majority与New配置文件中的Majority一定存在交集
```

下面给出在5节点集群上删除1个节点的情况：
```
Old: S1, S2, S3, S4, S5    Majority need:3
New: S1, S2, S3, S4        Majority Need:3
// 此时在Old中实现Majority可能需要S3，S4，S5；在New中实现Majority可能需要S1，S2, S3，存在交集
// 此时Old配置文件中的Majority与New配置文件中的Majority一定存在交集
```

## 可能导致的问题
### 可用性问题

### 

# （增/删）多节点
## 为什么不能向增删单节点一样？

## 步骤

## 证明

## 可能存在的问题

